# Changelog: Система покупки патронов

## Дата: 27 ноября 2025

### Добавлено

#### Новые типы данных
- `enum class AmmoType` - типы патронов (9x18, 5.45x39, 7.62x54)
- `struct AmmoItem` - структура для патронов с фабричным методом `create()`

#### Новые функции
- `Weapon::getAmmoType()` - определяет тип патронов для оружия
- `processAmmoPurchase()` - обрабатывает покупку патронов
  - Проверяет наличие денег
  - Проверяет наличие совместимого оружия
  - Добавляет патроны ко всем оружиям соответствующего типа

#### UI изменения
- Расширен магазин с 3 до 4 колонок
- Добавлена колонка "Ammo" с тремя типами патронов
- Увеличена ширина магазина с 1000px до 1300px
- Добавлены статусы покупки для патронов:
  - "Can purchase" (зеленый)
  - "No compatible weapon" (красный)
  - "Insufficient funds" (красный)

#### Обработка событий
- Добавлена обработка кликов по панелям патронов
- Добавлены уведомления о покупке патронов
- Добавлено логирование покупок в консоль

### Изменено

#### Структура магазина
- `UI_WIDTH`: 1000.0f → 1300.0f
- `COLUMN_WIDTH`: (scaledWidth - 80.0f * scale) / 3.0f → (scaledWidth - 100.0f * scale) / 4.0f
- `COLUMN_PADDING`: учитывает 4 колонки вместо 3

#### Логика покупок
- Патроны добавляются ко всем оружиям соответствующего типа в инвентаре
- Проверка совместимости оружия перед покупкой
- Автоматическое распределение патронов

### Технические детали

#### Измененные файлы
1. **Zero_Ground/Zero_Ground.cpp** (сервер)
   - Строки: ~150-200 (добавление AmmoType и AmmoItem)
   - Строки: ~2200-2280 (processAmmoPurchase)
   - Строки: ~2540-2850 (renderShopUI)
   - Строки: ~4450-4550 (обработка кликов)

2. **Zero_Ground_client/Zero_Ground_client.cpp** (клиент)
   - Аналогичные изменения

#### Совместимость патронов

| Тип патронов | Оружие | Цена | Количество |
|--------------|--------|------|------------|
| Bullets 9x18 | USP, Glock-18, Five-SeveN, R8 | $100 | 10 |
| Bullets 5,45x39 | Galil AR, M4, AK-47 | $150 | 30 |
| Bullets 7,62x54 | M10, AWP, M40 | $200 | 5 |

### Баланс

#### Стоимость за патрон
- Пистолетные: $10/патрон
- Автоматные: $5/патрон
- Снайперские: $40/патрон

Цены отражают мощность и эффективность оружия.

### Примеры использования

```cpp
// Проверка типа патронов оружия
Weapon* weapon = player.inventory[0];
AmmoType ammoType = weapon->getAmmoType();

// Покупка патронов
bool success = processAmmoPurchase(player, AmmoType::AMMO_9x18);

// Создание патронов
AmmoItem* ammo = AmmoItem::create(AmmoType::AMMO_5_45x39);
```

### Тестирование

См. файл `AMMO_TESTING_GUIDE.md` для подробных тестовых сценариев.

### Известные ограничения

1. Патроны добавляются только в резервный боезапас
2. Максимальный резервный боезапас не ограничен
3. Патроны одного типа подходят ТОЛЬКО для оружия соответствующего типа
4. Нельзя купить патроны без подходящего оружия

### Будущие улучшения

- [ ] Добавить ограничение на максимальный резервный боезапас
- [ ] Добавить возможность продавать патроны обратно
- [ ] Добавить скидки при покупке больших партий
- [ ] Добавить визуальную индикацию типа патронов в инвентаре
- [ ] Добавить звуковые эффекты при покупке

### Авторы

- Kiro AI Assistant

### Лицензия

Следует лицензии основного проекта Zero Ground.
