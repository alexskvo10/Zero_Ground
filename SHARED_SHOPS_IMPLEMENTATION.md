# Реализация общих магазинов для всех игроков

## Описание изменений

Магазины теперь генерируются один раз на сервере и синхронизируются со всеми клиентами. Это гарантирует, что все игроки видят одни и те же магазины в одних и тех же местах.

## Архитектура решения

### Серверная часть (Zero_Ground.cpp)

1. **Генерация магазинов**: Магазины генерируются один раз при запуске сервера функцией `generateShops()` в main()
2. **Хранение**: Магазины хранятся в глобальном векторе `std::vector<Shop> shops`
3. **Отправка клиентам**: Новая функция `sendShopsToClient()` отправляет позиции магазинов каждому подключающемуся клиенту

### Клиентская часть (Zero_Ground_client.cpp)

1. **Получение магазинов**: Новая функция `receiveShopsFromServer()` получает позиции магазинов от сервера
2. **Хранение**: Магазины хранятся в глобальном векторе `std::vector<Shop> shops`
3. **Рендеринг**: Существующая функция `renderShops()` отображает полученные магазины

## Протокол передачи данных

### Формат пакета магазинов (TCP)

1. **Количество магазинов** (1 байт): `uint8_t shopCount`
2. **Для каждого магазина** (8 байт):
   - `int32_t gridX` - координата X в сетке (4 байта)
   - `int32_t gridY` - координата Y в сетке (4 байта)

### Последовательность передачи при подключении клиента

1. Клиент отправляет ConnectPacket
2. Сервер отправляет карту (sendMapToClient)
3. **Сервер отправляет магазины (sendShopsToClient)** ← НОВОЕ
4. Сервер отправляет начальные позиции игроков
5. Клиент готов к игре

## Добавленные функции

### Zero_Ground.cpp (сервер)

```cpp
bool sendShopsToClient(sf::TcpSocket& clientSocket, const std::vector<Shop>& shops)
```
- Отправляет количество магазинов и их позиции клиенту
- Возвращает true при успехе, false при ошибке
- Логирует процесс отправки

### Zero_Ground_client.cpp (клиент)

```cpp
bool receiveShopsFromServer(sf::TcpSocket& serverSocket, std::vector<Shop>& shops)
```
- Получает количество магазинов и их позиции от сервера
- Вычисляет мировые координаты из координат сетки
- Возвращает true при успехе, false при ошибке
- Логирует процесс получения

## Преимущества решения

1. **Консистентность**: Все игроки видят одинаковые магазины
2. **Производительность**: Магазины генерируются один раз, а не для каждого игрока
3. **Надежность**: Использование TCP гарантирует доставку данных
4. **Простота**: Минимальные изменения в существующем коде
5. **Масштабируемость**: Легко добавить новые данные в протокол

## Тестирование

Для проверки работы:

1. Запустите сервер (Zero_Ground.exe)
2. Подключите клиента (Zero_Ground_client.exe)
3. Убедитесь, что оба видят красные квадраты магазинов в одних и тех же местах
4. Проверьте логи - должны быть сообщения:
   - Сервер: "Shops sent successfully: 26 shops"
   - Клиент: "Shops received successfully: 26 shops"

## Совместимость

- Изменения обратно несовместимы со старыми версиями клиента
- Старый клиент не сможет подключиться к новому серверу (будет ошибка при получении данных)
- Рекомендуется обновить все клиенты одновременно с сервером
