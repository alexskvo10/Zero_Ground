# План реализации (Упрощённая архитектура)

## ВАЖНО: Архитектурные требования
- Весь код сервера находится в одном файле: `Zero_Ground/Zero_Ground.cpp`
- Весь код клиента находится в одном файле: `Zero_Ground_client/Zero_Ground_client.cpp`
- НЕ создавать отдельные файлы для функций (создание стен, карты и т.д.)
- НЕ добавлять дополнительные зависимости (SFML уже подключена)
- НЕ создавать релизную конфигурацию и файлы для неё
- Все функции должны быть внутри основных cpp файлов

- [x] 1. Настройка структуры проекта




  - Проекты Visual Studio 2022 уже настроены с SFML 2.6.1
  - Работаем только с двумя cpp файлами
  - _Требования: Все_

- [x] 2. Реализация базовых структур данных и сетевого протокола





  - Определить структуры Position, Player, Wall, GameMap в cpp файлах
  - Реализовать структуры сетевых пакетов (ConnectPacket, ReadyPacket, StartPacket, MapDataPacket, PositionPacket)
  - Добавить функции валидации пакетов внутри cpp файлов
  - _Требования: 4.6, 5.5, 10.3, 10.4_

- [x] 3. Реализация системы генерации карты





  - Добавить функцию генерации карты в Zero_Ground.cpp для поля 500x500 единиц
  - Реализовать случайное размещение стен с ограничениями размера (2-8 единиц)
  - Рассчитать и обеспечить покрытие 25-35% от площади 250,000 кв. единиц
  - Реализовать BFS проверку проходимости между точками спавна
  - Добавить логику повторных попыток (максимум 10 попыток)
  - Обработать ошибку генерации с сообщением
  - _Требования: 1.1, 1.2, 1.3, 1.4, 1.5, 1.6_

- [x] 4. Реализация пространственного разбиения (Quadtree)





  - Добавить структуру Quadtree с методами вставки и запроса в cpp файлы
  - Реализовать рекурсивное разбиение (макс глубина 5, макс 10 стен на узел)
  - Построить quadtree из сгенерированных стен карты
  - _Требования: 11.3_

- [x] 5. Реализация системы обнаружения столкновений





  - Добавить функции обнаружения столкновений круг-прямоугольник в cpp файлы
  - Реализовать разрешение столкновений с отталкиванием на 1 единицу
  - Использовать quadtree для эффективного поиска ближайших стен
  - Добавить ограничение границ для удержания игроков в диапазоне [0, 500]
  - _Требования: 2.4, 2.5, 2.6_



- [x] 6. Реализация потокобезопасного менеджера состояния игры



  - Добавить структуру GameState с защищённой mutex картой игроков
  - Реализовать updatePlayerPosition с блокировкой mutex
  - Реализовать getPlayer и getPlayersInRadius с блокировкой mutex
  - Добавить методы setPlayerReady и allPlayersReady
  - _Требования: 10.1, 10.2_

- [x] 7. Реализация движения игрока и интерполяции





  - Добавить константу скорости движения (5 единиц/секунду)
  - Реализовать обработку ввода WASD с delta time
  - Хранить предыдущую позицию для интерполяции
  - Реализовать функцию lerp для плавной интерполяции позиции
  - _Требования: 2.1, 11.4_


- [x] 8. Реализация TCP слушателя сервера и обработки подключений



  - Создать TCP слушатель на порту 53000
  - Обработать запросы подключения клиентов
  - Получить и валидировать ConnectPacket
  - Отправить данные карты (MapDataPacket) подключённым клиентам
  - Отправить начальные позиции игроков подключённым клиентам
  - Обновить UI сервера для отображения "Игрок подключён, но не готов"
  - _Требования: 4.1, 4.3, 4.4, 6.6, 8.1, 8.2_




- [x] 9. Реализация протокола готовности на сервере







  - Получить ReadyPacket от клиентов через TCP
  - Обновить статус готовности игрока в GameState
  - Обновить UI сервера для отображения "Игрок подключён и готов играть"
  - Отобразить зелёную кнопку PLAY когда игрок готов
  - Отправить StartPacket всем клиентам при нажатии PLAY
  - Перейти на игровой экран сервера
  - _Требования: 6.7, 6.8, 6.9, 8.4, 8.5, 8.7_

- [x] 10. Реализация UDP синхронизации позиций на сервере




  - Создать UDP сокет на порту 53001
  - Запустить UDP слушатель в отдельном потоке
  - Получать обновления позиций от клиентов на частоте 20Hz
  - Валидировать полученные позиции
  - Обновить GameState валидированными позициями
  - Отправить позицию сервера клиентам
  - Реализовать сетевую отсечку (отправлять только игроков в радиусе 50 единиц)
  - _Требования: 4.2, 4.5, 4.7, 4.8, 5.4_

- [x] 11. Реализация стартового экрана UI сервера





  - Создать полноэкранное окно с SFML
  - Отобразить текст "СЕРВЕР ЗАПУЩЕН" зелёным цветом (64pt)
  - Получить и отобразить локальный IP адрес (обработать случаи 127.0.0.1/0.0.0.0)
  - Изначально отображать текст "Ожидание игрока..."
  - Реализовать клавишу Escape для переключения полноэкранного/оконного режима
  - Центрировать все элементы UI при изменении размера окна
  - _Требования: 6.1, 6.2, 6.3, 6.4, 6.5, 6.10_

- [x] 12. Реализация игрового рендеринга на сервере





  - Отрисовать игрока сервера как зелёный круг (радиус 30px)
  - Отрисовать подключённых клиентов как синие круги (радиус 20px)
  - Отрисовать все стены как серые прямоугольники
  - Использовать интерполированные позиции для плавного движения
  - Реализовать изоляцию ввода (сервер управляет только зелёным кругом)
  - _Требования: 2.2_

- [x] 13. Контрольная точка - Проверка работы сервера



  - Убедиться что сервер работает корректно, спросить пользователя при возникновении вопросов

- [x] 14. Реализация TCP подключения и рукопожатия клиента












  - Создать TCP сокет для подключения к серверу
  - Отправить ConnectPacket при успешном подключении
  - Получить и разобрать MapDataPacket
  - Получить начальные позиции игроков
  - Отобразить "Соединение установлено" при успехе
  - Отобразить сообщение об ошибке при неудаче (таймаут 3 секунды)
  - _Требования: 7.9, 7.10, 7.11, 8.1, 8.6_

- [x] 15. Реализация системы готовности клиента





  - Отобразить зелёную кнопку ГОТОВ (200x60px) после подключения
  - Отправить ReadyPacket при нажатии кнопки
  - Отобразить "Ожидание старта игры..." после отправки готовности
  - Получить StartPacket от сервера
  - Перейти на игровой экран при получении сигнала старта
  - _Требования: 7.12, 7.13, 7.14, 7.15, 8.3, 8.6_


- [x] 16. Реализация UDP синхронизации позиций на клиенте











  - Создать UDP сокет на порту 53002
  - Запустить UDP отправитель в отдельном потоке
  - Отправлять позицию локального игрока на частоте 20Hz
  - Получать позиции других игроков от сервера
  - Обновить локальное состояние полученными позициями
  - Обработать потерю соединения (таймаут 2 секунды)
  - _Требования: 4.5, 5.1_

-

- [x] 17. Реализация экрана подключения UI клиента



  - Создать полноэкранное окно с SFML
  - Отобразить метку "IP АДРЕС СЕРВЕРА:" (32pt)
  - Создать поле ввода IP (400x50px, тёмно-серый фон)
  - Реализовать валидацию ввода (только цифры и точки, макс 15 символов)
  - Корректно обработать клавишу Backspace
  - Подсветить поле ввода при фокусе (зелёная обводка)
  - Отобразить кнопку "ПОДКЛЮЧИТЬСЯ К СЕРВЕРУ" (300x70px)
  - Обработать клавишу Enter для запуска подключения
  - Отобразить сообщение об ошибке красным при неудаче подключения
  - Реализовать клавишу Escape для переключения полноэкранного/оконного режима
  - _Требования: 7.1, 7.2, 7.3, 7.4, 7.5, 7.6, 7.7, 7.8, 7.9, 7.10, 7.16_

- [x] 18. Реализация системы рендеринга тумана войны




  - Добавить функции рендеринга тумана войны в Zero_Ground_client.cpp
  - Рассчитать радиус видимости (25 единиц) вокруг игрока
  - Отрисовать все стены (затемнённые вне радиуса, нормальные внутри)
  - Отрисовать только игроков в радиусе 25 единиц
  - Применить чёрный полупрозрачный оверлей (альфа 200) вне радиуса
  - Использовать шейдер для круговой отсечки тумана (опциональное улучшение)
  - _Требования: 3.1, 3.2, 3.3, 3.4, 3.5, 3.6_

- [x] 19. Реализация игрового рендеринга на клиенте










  - Отрисовать локального игрока как синий круг (радиус 30px)
  - Отрисовать игрока сервера как зелёный круг (радиус 20px) если видим
  - Отрисовать стены с эффектами тумана войны
  - Использовать интерполированные позиции для плавного движения
  - Реализовать изоляцию ввода (клиент управляет только синим кругом)
  - _Требования: 2.3_

- [x] 20. Реализация HUD и визуальной обратной связи




  - Отобразить полоску здоровья над игроком (зелёный прямоугольник, 100 HP)
  - Обновлять ширину полоски здоровья на основе текущего здоровья
  - Отобразить "Счёт: [число]" в верхнем левом углу
  - Применить затемнение всего экрана при смерти игрока
  - _Требования: 9.1, 9.2, 9.3, 9.4, 9.5_

- [x] 21. Реализация системы переподключения





  - Обнаружить потерю соединения (нет пакетов в течение 2 секунд)
  - Отобразить экран "Соединение потеряно. Нажмите R для переподключения к [IP]"
  - Реализовать обработчик клавиши R для повторной попытки подключения
  - Восстановить состояние игры при успешном переподключении
  - _Требования: 5.1, 5.2_

- [x] 22. Реализация мониторинга производительности




  - Добавить функции мониторинга производительности в cpp файлы
  - Отслеживать частоту кадров в окнах по 1 секунде
  - Логировать предупреждение когда FPS падает ниже 55
  - Логировать дополнительные метрики (количество игроков, стен, использование CPU)
  - _Требования: 11.5_

- [x] 23. Реализация обработки ошибок и логирования




  - Добавить функции обработки ошибок в cpp файлы
  - Обработать ошибки невалидных пакетов (логировать и отбросить)
  - Обработать ошибки потери соединения (показать экран переподключения)
  - Обработать ошибку генерации карты (отобразить ошибку и выйти)
  - Добавить логирование для всех сетевых ошибок
  - _Требования: 5.3, 5.4, 1.6_

- [x] 24. Финальная контрольная точка - Проверка работы




  - Убедиться что всё работает корректно, спросить пользователя при возникновении вопросов

- [x] 25. Интеграционное тестирование







  - Протестировать полную последовательность рукопожатия сервер-клиент
  - Протестировать поток протокола готовности (подключение → готовность → старт)
  - Протестировать синхронизацию позиций во время игры
  - Протестировать обнаружение столкновений с несколькими игроками
  - Протестировать видимость тумана войны с движущимися игроками
  - Протестировать переподключение после потери соединения
  - Протестировать переключение полноэкранного режима на сервере и клиенте

- [x] 26. Тестирование производительности и оптимизация




  - Измерить время генерации карты (цель < 100мс)
  - Измерить обнаружение столкновений (цель < 1мс на кадр)
  - Профилировать использование CPU с 2 игроками (цель < 40%)
  - Измерить использование сетевой пропускной способности
  - Проверить 55+ FPS на целевом железе (Intel i3-8100, 8GB RAM)
  - Оптимизировать запросы quadtree при необходимости
  - Оптимизировать рендеринг при необходимости

- [x] 27. Очистка кода и документация




  - Добавить комментарии к коду, объясняющие сложные алгоритмы (BFS, quadtree)
  - Документировать сетевой протокол в README.md
  - Добавить инструкции по сборке для Visual Studio 2022
  - Документировать требования настройки SFML 2.6.1
  - Добавить инструкции по использованию (как запустить сервер и клиент)
  - Документировать известные ограничения и будущие улучшения
