# План реализации

**ВАЖНО**: Все задачи на стороне клиента (рендеринг, UI, HUD) должны быть реализованы в ОБОИХ файлах:
- Zero_Ground.cpp (для игрока-хоста)
- Zero_Ground_client.cpp (для удаленных игроков)

Это обеспечивает идентичный визуальный опыт и функциональность для всех игроков.

- [x] 1. Определить основные структуры данных для оружия и магазина





  - Добавить структуру Weapon со всеми 10 типами оружия и их свойствами в файлы сервера и клиента
  - Добавить структуру Shop с позицией на сетке и мировыми координатами
  - Добавить структуру Bullet с позицией, скоростью, уроном и отслеживанием дальности
  - Расширить структуру Player массивом инвентаря (4 слота), activeSlot и полем денег
  - _Требования: 1.1, 11.1, 11.2_

- [x] 1.1 Написать тест свойств для инициализации оружия


  - **Свойство 33: Полнота свойств оружия**
  - **Проверяет: Требования 11.2**

- [x] 2. Реализовать алгоритм генерации магазинов на сервере





  - Написать функцию для генерации 26 случайных неперекрывающихся позиций магазинов на сетке 51×51
  - Реализовать проверку расстояния от точек спавна (минимум 5 клеток)
  - Реализовать проверку связности через BFS
  - Добавить резервный шаблон размещения магазинов, если генерация не удалась после 100 попыток
  - _Требования: 2.1, 2.2, 2.3, 2.4, 2.5_

- [x] 2.1 Написать тест свойств для генерации магазинов


  - **Свойство 2: Инвариант количества магазинов**
  - **Свойство 3: Уникальность позиций магазинов**
  - **Свойство 4: Ограничение расстояния от спавна магазинов**
  - **Проверяет: Требования 2.1, 2.2, 2.3**

- [x] 3. Реализовать инициализацию спавна игрока





  - Изменить логику спавна игрока для экипировки USP в слот 0
  - Инициализировать слоты 1-3 как пустые (nullptr)
  - Установить начальный баланс денег на 50,000
  - _Требования: 1.1, 1.2, 1.3_

- [x] 3.1 Написать тест свойств для состояния спавна игрока


  - **Свойство 1: Инициализация спавна игрока**
  - **Проверяет: Требования 1.1, 1.2, 1.3**

- [x] 4. Реализовать рендеринг магазинов в обоих клиентских файлах










  - Отрисовывать каждый магазин как красный квадрат 20×20 в центре клетки сетки (x+40, y+40)
  - Реализовать видимость магазинов с интеграцией тумана войны
  - Отображать подсказку "Нажмите B для покупки", когда игрок в пределах 60 пикселей
  - **Реализовать в ОБОИХ Zero_Ground.cpp и Zero_Ground_client.cpp**
  - _Требования: 2.6, 3.1, 10.5_

- [x] 4.1 Написать тест свойств для дальности взаимодействия с магазином






  - **Свойство 5: Дальность взаимодействия с магазином**
  - **Свойство 32: Согласованность тумана войны для магазинов**
  - **Проверяет: Требования 3.1, 10.5**

- [x] 5. Реализовать интерфейс магазина в обоих клиентских файлах










  - Создать меню магазина с тремя колонками: "Пистолеты", "Автоматы", "Снайперки"
  - Отображать название оружия, цену, урон и размер магазина для каждого оружия
  - Показывать статус покупки (можно купить/недостаточно средств/инвентарь полон)
  - **Реализовать в ОБОИХ Zero_Ground.cpp и Zero_Ground_client.cpp**
  - Обрабатывать нажатие клавиши B для открытия/закрытия магазина в пределах дальности
  - _Требования: 3.2, 3.3, 3.4, 3.5_

- [x] 5.1 Написать тест свойств для расчета статуса покупки




  - **Свойство 6: Расчет статуса покупки**
  - **Проверяет: Требования 3.5**

- [x] 6. Реализовать проверку покупки и логику транзакций на сервере







  - Проверить, что у игрока достаточно денег для цены оружия
  - Проверить, что у игрока есть пустой слот инвентаря
  - Вычесть цену оружия из денег игрока при успешной покупке
  - Добавить оружие в первый пустой слот инвентаря
  - Инициализировать оружие с полным магазином и запасными патронами
  - Отправить пакет обновления инвентаря всем клиентам
  - _Требования: 4.1, 4.2, 4.3, 4.4, 4.5_

- [x] 6.1 Написать тесты свойств для механики покупки




  - **Свойство 7: Недостаток средств предотвращает покупку**
  - **Свойство 8: Полный инвентарь предотвращает покупку**
  - **Свойство 9: Вычитание денег при покупке**
  - **Свойство 10: Размещение оружия в первом пустом слоте**
  - **Свойство 11: Инициализация купленного оружия**
  - **Проверяет: Требования 4.1, 4.2, 4.3, 4.4, 4.5**

- [x] 7. Реализовать управление инвентарем и переключение оружия в обоих клиентских файлах




  - Обрабатывать клавиши 1-4 для активации соответствующих слотов инвентаря (0-3)
  - Устанавливать активное оружие при выборе непустого слота
  - Очищать активное оружие и восстанавливать скорость до 3.0 при выборе пустого слота
  - Применять модификатор скорости движения оружия, когда оружие активно
  - **Реализовать в ОБОИХ Zero_Ground.cpp и Zero_Ground_client.cpp**
  - _Требования: 5.1, 5.2, 5.3, 5.4_

- [x] 7.1 Написать тесты свойств для системы инвентаря


  - **Свойство 12: Активация слота инвентаря**
  - **Свойство 13: Непустой слот устанавливает активное оружие**
  - **Свойство 14: Пустой слот очищает оружие и восстанавливает скорость**
  - **Свойство 15: Модификация скорости оружия**
  - **Проверяет: Требования 5.1, 5.2, 5.3, 5.4**

- [x] 8. Реализовать обновления HUD для системы оружия в обоих клиентских файлах





  - Отображать баланс денег под здоровьем в верхнем левом углу
  - Отображать название оружия и количество патронов "[Название]: [текущие]/[запас]" в верхнем правом углу, когда оружие активно
  - Отображать "Без оружия" в верхнем правом углу, когда нет активного оружия
  - **Реализовать в ОБОИХ Zero_Ground.cpp и Zero_Ground_client.cpp**
  - _Требования: 1.5, 5.5, 5.6_

- [x] 9. Реализовать механику стрельбы в обоих клиентских файлах






  - Обрабатывать нажатие левой кнопки мыши для выстрела
  - Рассчитывать траекторию пули от позиции игрока к курсору
  - Проверять патроны в магазине > 0 перед выстрелом
  - Запускать автоматическую перезарядку при пустом магазине
  - Обрабатывать клавишу R для ручной перезарядки
  - Предотвращать стрельбу во время перезарядки
  - Отправлять пакет выстрела на сервер с данными пули
  - **Реализовать в ОБОИХ Zero_Ground.cpp и Zero_Ground_client.cpp**
  - _Требования: 6.1, 6.2, 6.3, 6.4_

- [x] 9.1 Написать тесты свойств для механики стрельбы



  - **Свойство 16: Создание пули при действительном выстреле**
  - **Свойство 17: Пустой магазин запускает перезарядку**
  - **Свойство 18: Инициация ручной перезарядки**
  - **Свойство 19: Перезарядка предотвращает стрельбу**
  - **Проверяет: Требования 6.1, 6.2, 6.3, 6.4**

- [x] 10. Реализовать механику перезарядки в обоих клиентских файлах



  - Отслеживать состояние перезарядки и таймер для каждого оружия
  - Переносить патроны из запаса в магазин при завершении перезарядки
  - Обрабатывать случай, когда запас < вместимости магазина
  - Обновлять отображение патронов в HUD во время перезарядки
  - **Реализовать в ОБОИХ Zero_Ground.cpp и Zero_Ground_client.cpp**
  - _Требования: 6.5_

- [x] 10.1 Написать тест свойств для переноса патронов при перезарядке



  - **Свойство 20: Перенос патронов при перезарядке**
  - **Проверяет: Требования 6.5**

- [x] 11. Реализовать физику и рендеринг пуль в обоих клиентских файлах
  - Создавать сущность пули при выстреле с позицией, скоростью и уроном
  - Обновлять позицию пули каждый кадр на основе скорости и deltaTime
  - Отрисовывать пули как белые линии (длина 5px, ширина 2px)
  - Удалять пули, превышающие эффективную дальность оружия
  - Удалять пули за пределами области экрана + 20% буфер
  - Удалять пули за пределами границ карты (0-5100px)
  - Обеспечивать максимум 20 активных пуль на игрока
  - **Реализовать в ОБОИХ Zero_Ground.cpp и Zero_Ground_client.cpp**
  - _Требования: 7.1, 7.2, 7.5, 10.1, 10.2,2, 10.3_

- [x] 11.1 Написать тесты свойств для поведения пуль
  - **Свойство 21: Скорость пули соответствует оружию**
  - **Свойство 24: Ограничение дальности удаляет пулю**
  - **Свойство 29: Ограничение количества пуль**
  - **Свойство 30: Отсечение за пределами экрана удаляет пули**
  - **Свойство 31: Границы карты удаляют пули**
  - **Проверяет: Требования 7.2, 7.5, 10.1, 10.2, 10.3**

- [x] 12. Реализовать обнаружение столкновений пуль на сервере
  - Реализовать пространственную структуру quadtree с ячейками 100×100px
  - Проверять столкновения пуль со стенами и удалять пули при попадании
  - Проверять столкновения пуль с игроками и удалять пули при попадании
  - Отправлять пакет попадания всем клиентам, когда пуля попадает в игрока
  - _Требования: 7.3, 7.4, 10.4_

- [x] 12.1 Написать тесты свойств для столкновений пуль
  - **Свойство 22: Столкновение со стеной удаляет пулю**
  - **Свойство 23: Столкновение с игроком удаляет пулю и наносит урон**
  - **Проверяет: Требования 7.3, 7.4**

- [x] 13. Реализовать систему урона на сервере
  - Применять урон оружия к здоровью игрока при попадании пули
  - Проверять смерть игрока (здоровье <= 0)
  - Награждать $5000 игроку, убившему противника
  - Планировать возрождение через 5 секунд
  - Восстанавливать здоровье до 100 HP при возрождении
  - Транслировать события урона и смерти всем клиентам
  - _Требования: 8.1, 8.3, 8.4, 8.5_

- [x] 13.1 Написать тесты свойств для системы урона
  - **Свойство 25: Урон уменьшает здоровье**
  - **Свойство 26: Смерть запускает возрождение**
  - **Свойство 27: Награда за убийство**
  - **Свойство 28: Восстановление здоровья при возрождении**
  - **Проверяет: Требования 8.1, 8.3, 8.4, 8.5**

- [x] 14. Реализовать визуализацию урона в обоих клиентских файлах
  - Отображать всплывающий красный текст "-[урон]" над пораженным игроком
  - Анимировать текст, движущийся вверх в течение 1 секунды
  - Использовать размер шрифта 24px красного цвета
  - **Реализовать в ОБОИХ Zero_Ground.cpp и Zero_Ground_client.cpp**
  - _Требования: 8.2_

- [x] 15. Реализовать сетевую синхронизацию
  - Определить структуру ShotPacket с ID игрока, позицией, направлением, типом оружия
  - Определить структуру HitPacket с ID стрелка, ID жертвы, уроном, позицией попадания
  - Определить структуру PurchasePacket с ID игрока и типом оружия
  - Определить структуру InventoryPacket с ID игрока, слотом, типом оружия, деньгами
  - Отправлять позиции магазинов клиентам при генерации карты
  - Транслировать события выстрелов всем клиентам
  - Транслировать события попаданий всем клиентам
  - Синхронизировать изменения инвентаря со всеми клиентами
  - _Требования: 7.6, 9.1, 9.2, 9.3, 9.4, 9.5_

- [x] 16. Реализовать серверную проверку выстрелов
  - Проверять, что у игрока есть активное оружие
  - Проверять, что у оружия есть патроны > 0
  - Проверять, что прошло время перезарядки выстрела
  - Выполнять авторитетный raycast для обнаружения попаданий
  - Игнорировать недействительные выстрелы без трансляции
  - _Требования: 9.2, 9.4_

- [ ] 17. Контрольная точка - Убедиться, что все тесты проходят
  - Убедиться, что все тесты проходят, спросить пользователя, если возникнут вопросы.

- [ ] 18. Написать интеграционные тесты для взаимодействия клиент-сервер
  - Тест потока покупки: запрос клиента → проверка сервера → обновление инвентаря
  - Тест потока боя: клиент стреляет → сервер проверяет → урон применен → клиенты уведомлены
  - Тест синхронизации магазинов: сервер генерирует → клиенты получают позиции

- [ ] 19. Написать тесты производительности
  - Тест нагрузки пулями: 10 игроков непрерывно стреляют, измерить время кадра с 200 пулями
  - Тест рендеринга магазинов: 26 видимых магазинов, измерить время рендеринга
  - Тест обнаружения столкновений: 100 пуль + 50 игроков, измерить время столкновений
  - Цель: поддерживать 60 FPS (< 16.67мс на кадр)
