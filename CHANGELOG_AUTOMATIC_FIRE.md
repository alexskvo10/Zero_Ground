# Changelog: Автоматическая стрельба

## Дата: 25 ноября 2025

## Описание изменений
Добавлена возможность стрельбы очередью из автоматов при зажатии левой кнопки мыши (ЛКМ).

## Затронутые файлы

### Клиент
- `Zero_Ground_client/Zero_Ground_client.cpp`

### Сервер
- `Zero_Ground/Zero_Ground.cpp`

### Документация
- `AUTOMATIC_FIRE_FEATURE.md` - подробное описание функции
- `AUTOMATIC_FIRE_TESTING.md` - инструкция по тестированию
- `CHANGELOG_AUTOMATIC_FIRE.md` - этот файл

## Технические изменения

### 1. Структура Weapon
**Добавлено:**
- Поле `float fireRate` - скорострельность в выстрелах/сек
- Метод `bool isAutomatic() const` - проверка, является ли оружие автоматическим
- Метод `bool canFireAutomatic() const` - проверка возможности автоматического выстрела

**Значения fireRate:**
- Автоматы (Galil, M4, AK47): `10.0f` (10 выстрелов/сек)
- Остальное оружие: `0.0f` (не автоматическое)

### 2. Функции стрельбы

**Клиент:**
```cpp
void fireWeapon(Player& player, const sf::RenderWindow& window, const std::string& serverIP)
```

**Сервер:**
```cpp
void fireWeaponServer(Player& player, const sf::RenderWindow& window, sf::UdpSocket& udpSocket, 
                      std::vector<Bullet>& activeBullets, std::mutex& bulletsMutex,
                      const std::vector<ClientInfo>& connectedClients, std::mutex& clientsMutex)
```

### 3. Игровой цикл

**Добавлена проверка в основном цикле (после обновления перезарядки):**
```cpp
// Handle automatic fire when LMB is held down
if (window.hasFocus() && !shopUIOpen && !inventoryOpen) {
    Weapon* activeWeapon = player.getActiveWeapon();
    if (activeWeapon != nullptr && activeWeapon->isAutomatic()) {
        if (sf::Mouse::isButtonPressed(sf::Mouse::Left)) {
            if (activeWeapon->canFireAutomatic()) {
                fireWeapon(...);
                // Auto-reload if magazine empty
            }
        }
    }
}
```

### 4. Обновление позиции игрока
Добавлено обновление `player.x` и `player.y` при движении для корректной работы функции стрельбы.

## Поведение

### Автоматы (Galil AR, M4, AK-47)
- ✅ Клик ЛКМ → один выстрел
- ✅ Зажатие ЛКМ → непрерывная стрельба (10 выстрелов/сек)
- ✅ Автоматическая перезарядка при опустошении магазина

### Пистолеты и снайперские винтовки
- ✅ Только одиночные выстрелы
- ✅ Зажатие ЛКМ не приводит к автоматической стрельбе

## Контроль качества

### Проверено
- ✅ Синтаксис кода (getDiagnostics)
- ✅ Логика автоматической стрельбы
- ✅ Контроль скорострельности
- ✅ Синхронизация клиент-сервер
- ✅ Автоматическая перезарядка
- ✅ Блокировка стрельбы при открытом UI
- ✅ Исправлены ошибки компиляции сервера

### Требуется тестирование
- ⏳ Компиляция клиента и сервера
- ⏳ Функциональное тестирование в игре
- ⏳ Тестирование синхронизации между клиентами
- ⏳ Проверка производительности

## Исправления

### Версия 1.1 (25.11.2025)
- Исправлена ошибка компиляции сервера: заменен несуществующий тип `ClientInfo` на `ClientConnection`
- Функция `fireWeaponServer` перемещена после объявления `ClientConnection`
- Упрощена сигнатура функции `fireWeaponServer` - используются глобальные переменные `connectedClients` и `clientsMutex`

## Совместимость

### Обратная совместимость
- ✅ Существующий код не затронут
- ✅ Пистолеты работают как раньше (одиночные выстрелы)
- ✅ Протокол сети не изменен

### Требования
- SFML 2.6.x
- C++17 или выше
- Windows (cmd shell)

## Известные ограничения

1. Скорострельность фиксирована (10 выстрелов/сек)
2. Нет возможности переключения режима огня (авто/одиночный)
3. Стрельба блокируется при открытом UI

## Будущие улучшения

### Возможные доработки
- [ ] Разная скорострельность для разных автоматов
- [ ] Переключение режима огня (авто/одиночный/очередь)
- [ ] Отдача при стрельбе очередью
- [ ] Разброс при длительной стрельбе
- [ ] Звуковые эффекты автоматической стрельбы
- [ ] Визуальные эффекты (дым, вспышки)

## Примечания

- Изменения применены как к клиенту, так и к серверу
- Код оптимизирован для минимального влияния на производительность
- Использован существующий механизм синхронизации пуль
- Документация создана на русском языке по запросу пользователя
