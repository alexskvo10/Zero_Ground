# Объяснение метрик CPU и производительности

## Обновленные метрики (v2)

### Что изменилось

Раньше система показывала упрощенную "Estimated CPU Usage", которая могла достигать 100% даже когда процессор не был полностью загружен. Теперь система показывает две более точные метрики:

1. **Game Thread Load** - загрузка игрового потока
2. **Estimated CPU Usage** - оценка реального использования CPU

## Метрики в деталях

### 1. Game Thread Load (Загрузка игрового потока)

**Что это:**
- Показывает, какой процент от бюджета кадра используется
- Бюджет кадра = 16.67мс (для 60 FPS)
- Формула: `(Frame Time / 16.67ms) * 100%`

**Примеры:**
```
Frame Time: 16.67ms → Game Thread Load: 100% (идеально для 60 FPS)
Frame Time: 18.25ms → Game Thread Load: 109% (превышает бюджет)
Frame Time: 14.00ms → Game Thread Load: 84% (запас производительности)
```

**Интерпретация:**
- **< 100%**: Игра работает быстрее чем нужно для 60 FPS (хорошо!)
- **100%**: Игра использует весь бюджет кадра (нормально)
- **> 100%**: Кадры занимают больше времени чем нужно (FPS упадет ниже 60)
- **> 110%**: Значительное превышение бюджета (нужна оптимизация)

### 2. Estimated CPU Usage (Оценка использования CPU)

**Что это:**
- Более консервативная оценка реального использования процессора
- Предполагает что игра при полной загрузке использует ~40% CPU
- Формула: `(Game Thread Load / 100%) * 40%`

**Примеры:**
```
Game Thread Load: 100% → Estimated CPU: 40%
Game Thread Load: 109% → Estimated CPU: 43.6%
Game Thread Load: 50%  → Estimated CPU: 20%
```

**Интерпретация:**
- **< 40%**: Хорошая производительность, CPU не перегружен
- **40-50%**: Нормальная нагрузка
- **> 50%**: Высокая нагрузка, возможны проблемы

## Сравнение старой и новой системы

### Старая система (v1)
```
Avg Frame Time: 18.2588ms
Estimated CPU Usage: 100%  ← Вводит в заблуждение!
```

**Проблема:** Показывает 100% даже когда CPU не полностью загружен.

### Новая система (v2)
```
Avg Frame Time: 18.2588ms
Game Thread Load: 109% of frame budget  ← Точно показывает превышение
Estimated CPU Usage: 43.6% (target: <40%)  ← Реалистичная оценка
Note: Running Debug build? Release build typically 30-50% faster
```

**Преимущества:**
- ✓ Более точная оценка реального использования CPU
- ✓ Понятно что превышен бюджет кадра, а не CPU на 100%
- ✓ Подсказка о Debug/Release build
- ✓ Более полезные предупреждения

## Примеры интерпретации

### Пример 1: Debug Build (ваш случай)
```
=== PERFORMANCE METRICS ===
FPS: 54.9886 (target: 55+)
Frame Time: 18.1856ms
Game Thread Load: 109% of frame budget
Estimated CPU Usage: 43.6% (target: <40%)
Note: Running Debug build? Release build typically 30-50% faster
```

**Анализ:**
- FPS чуть ниже 55 - нормально для Debug
- Game Thread Load 109% - кадры занимают на 9% больше времени
- CPU Usage 43.6% - близко к цели, не критично
- **Вывод:** Для Debug build это хорошие показатели!

### Пример 2: Release Build (ожидаемое)
```
=== PERFORMANCE METRICS ===
FPS: 60.0 (target: 55+)
Frame Time: 16.67ms
Game Thread Load: 100% of frame budget
Estimated CPU Usage: 40% (target: <40%)
```

**Анализ:**
- FPS стабильно 60 - отлично!
- Game Thread Load 100% - идеально использует бюджет
- CPU Usage 40% - точно в цели
- **Вывод:** Оптимальная производительность!

### Пример 3: Проблема производительности
```
=== PERFORMANCE METRICS ===
FPS: 45.2 (target: 55+)
Frame Time: 22.12ms
Game Thread Load: 132% of frame budget
Estimated CPU Usage: 52.8% (target: <40%)

[WARNING] Game thread load exceeds frame budget: 132%
  This means frames are taking longer than 16.67ms
  Consider optimizing or using Release build
```

**Анализ:**
- FPS значительно ниже 55 - проблема!
- Game Thread Load 132% - серьезное превышение бюджета
- CPU Usage 52.8% - высокая нагрузка
- **Вывод:** Нужна оптимизация или Release build

## Целевые показатели

| Метрика | Идеально | Хорошо | Приемлемо | Проблема |
|---------|----------|--------|-----------|----------|
| FPS | 60 | 55-60 | 50-55 | < 50 |
| Frame Time | 16.67ms | 16-18ms | 18-20ms | > 20ms |
| Game Thread Load | 100% | 90-110% | 110-120% | > 120% |
| Estimated CPU Usage | 40% | 30-45% | 45-50% | > 50% |

## Debug vs Release Build

### Debug Build (текущий)
- Без оптимизаций компилятора
- Дополнительные проверки
- Символы отладки
- **Ожидаемая производительность:** 60-70% от Release

**Типичные показатели:**
- FPS: 50-55
- Frame Time: 18-20ms
- Game Thread Load: 105-115%
- CPU Usage: 42-46%

### Release Build (рекомендуется для финального тестирования)
- Полные оптимизации компилятора
- Без проверок отладки
- Оптимизированный код
- **Ожидаемая производительность:** 100%

**Типичные показатели:**
- FPS: 60
- Frame Time: 16-17ms
- Game Thread Load: 95-105%
- CPU Usage: 38-42%

## Рекомендации

### Для Debug Build
✓ FPS 50-55 - нормально
✓ Game Thread Load 105-115% - ожидаемо
✓ CPU Usage 40-50% - приемлемо

### Для Release Build
✓ FPS 55-60 - цель
✓ Game Thread Load 95-105% - оптимально
✓ CPU Usage 35-45% - в пределах нормы

### Когда оптимизировать
❌ Game Thread Load > 120% в Release
❌ FPS < 50 в Release
❌ CPU Usage > 55% в Release
❌ Collision Time > 1ms

## Заключение

Новая система метрик предоставляет:
1. **Game Thread Load** - точно показывает использование бюджета кадра
2. **Estimated CPU Usage** - реалистичная оценка нагрузки на процессор
3. **Полезные подсказки** - о Debug/Release и оптимизации
4. **Понятные предупреждения** - с конкретными рекомендациями

Ваши текущие показатели (FPS ~55, Game Thread Load ~109%) **нормальны для Debug build** и не требуют немедленной оптимизации. Для финальной оценки производительности рекомендуется протестировать Release build.
