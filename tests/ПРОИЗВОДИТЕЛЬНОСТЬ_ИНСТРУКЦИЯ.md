# Инструкция по тестированию производительности

## Быстрый старт

```cmd
cd tests
run_performance_tests.bat
```

## Целевые показатели производительности

| Метрика | Цель | Типичное значение | Предупреждение |
|---------|------|-------------------|----------------|
| Генерация карты | < 100мс | 30-80мс | > 100мс |
| FPS | 55+ | 60 | < 55 |
| Обнаружение столкновений | < 1мс | 0.1-0.3мс | > 1мс |
| Использование CPU | < 40% | 25-35% | > 40% |
| Сетевая пропускная способность | Мониторинг | 1-2КБ/с | Н/Д |

## Что смотреть в консоли

### При запуске сервера
```
=== MAP GENERATION PERFORMANCE ===
Total Time: 45ms (target: <100ms)
Attempts: 1
Walls Generated: 18
Coverage: 28.5%
[SUCCESS] Map generation within target time
===================================
```
✓ Время должно быть < 100мс

### Во время игры (каждую секунду)
```
=== PERFORMANCE METRICS ===
FPS: 60.2 (target: 55+)
Frame Time: 16.6ms
Players: 2
Walls: 18
Avg Collision Detection: 0.15ms (target: <1ms)
Network Bandwidth Sent: 1280 bytes/sec
Network Bandwidth Received: 640 bytes/sec
Estimated CPU Usage: 28.5% (target: <40%)
==========================
```
✓ FPS должен быть 55+
✓ Столкновения < 1мс
✓ CPU < 40%

### Предупреждение о производительности
```
[WARNING] Performance degradation detected!
  FPS: 52.3 (target: 55+)
  Players: 2
  Walls: 18
  Avg Collision Time: 0.18ms (target: <1ms)
  Avg Frame Time: 19.1ms
  Estimated CPU Usage: 35.2%
```
⚠ Требуется действие: проверьте системные ресурсы

## Что означает каждая метрика

**FPS (Кадров в секунду)**
- Сколько кадров отрисовывается в секунду
- Цель: 55+ (игра работает с ограничением 60 FPS)
- Ниже = прерывистый геймплей

**Frame Time (Время кадра)**
- Время на отрисовку одного кадра в миллисекундах
- Цель: ~16.67мс (60 FPS)
- Выше = ниже FPS

**Collision Detection (Обнаружение столкновений)**
- Время на проверку столкновений игрок-стена
- Цель: < 1мс на кадр
- Оптимизировано с помощью Quadtree

**CPU Usage (Использование процессора)**
- Оценочное использование процессора
- Цель: < 40% с 2 игроками
- Основано на времени кадра

**Network Bandwidth (Сетевая пропускная способность)**
- Данные отправленные/полученные в секунду
- Sent: Сервер → Клиенты
- Received: Клиенты → Сервер
- Оптимизировано с пространственной отсечкой

## Функции оптимизации

✓ **Quadtree пространственное разбиение**
- Уменьшает проверки столкновений на 80-90%
- O(log n) вместо O(n)

✓ **Сетевая пространственная отсечка**
- Отправляет только игроков в радиусе 50 единиц
- Уменьшает пропускную способность на 50%+

✓ **Интерполированное движение**
- Плавные 60 FPS с обновлениями 20Hz
- Без визуальных рывков

✓ **Независимое от кадров движение**
- Постоянная скорость независимо от FPS
- Использует delta time

## Устранение неполадок

**FPS < 55?**
- Закройте другие приложения
- Проверьте использование CPU
- Убедитесь что время столкновений < 1мс
- Проверьте фоновые процессы

**Столкновения > 1мс?**
- Проверьте количество стен (должно быть 15-25)
- Убедитесь что Quadtree работает (смотрите логи)
- Может указывать на проблему с пространственным разбиением

**CPU > 40%?**
- Нормально с большим количеством игроков
- Проверьте утечки памяти
- Профилируйте горячие участки кода
- Рассмотрите оптимизацию

**Высокая сетевая пропускная способность?**
- Убедитесь что пространственная отсечка работает
- Проверьте расстояния между игроками
- Должна уменьшаться когда игроки далеко

## Сценарии тестирования

1. **Тест простоя**: Оба игрока неподвижны
   - Ожидается: 60 FPS, низкий CPU, минимальная пропускная способность

2. **Тест движения**: Оба игрока двигаются
   - Ожидается: 55+ FPS, умеренный CPU, нормальная пропускная способность

3. **Тест столкновений**: Игроки рядом со стенами
   - Ожидается: Столкновения < 1мс, стабильный FPS

4. **Тест расстояния**: Игроки далеко друг от друга
   - Ожидается: Уменьшенная пропускная способность (отсечка)

## Документация

- `PERFORMANCE_TESTING_GUIDE.md` - Полные процедуры тестирования (English)
- `PERFORMANCE_TEST_RESULTS.md` - Детальный анализ (English)
- `PERFORMANCE_QUICK_REFERENCE.md` - Быстрая справка (English)

## Поддержка

Если проблемы с производительностью сохраняются:
1. Проверьте консоль на предупреждения
2. Просмотрите руководство по тестированию
3. Убедитесь что оборудование соответствует требованиям
4. Проверьте ограничения системных ресурсов

## Требования к оборудованию

- **Рекомендуемое**: Intel i3-8100 или эквивалент
- **ОЗУ**: 8GB
- **ОС**: Windows 10/11
- **Компилятор**: Visual Studio 2022
- **Библиотеки**: SFML 2.6.1 (уже настроена)
